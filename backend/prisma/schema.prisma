generator client {
  provider        = "prisma-client-js"
  previewFeatures = ["clientExtensions"]
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model User {
  id              String    @id @default(uuid())
  name            String
  email           String    @unique
  password        String
  ethnicity       String
  countryOfOrigin String
  dateOfBirth     String
  role            UserRole  @default(REGULAR)
  activeVote      Vote?     @relation(name: "activeVote", fields: [activeVoteId], references: [id])
  activeVoteId    String    @unique
  pictures        Picture[]
  votes           Vote[]
  createdAt       DateTime  @default(now())
  updatedAt       DateTime  @updatedAt
  voteId          String
}

enum UserRole {
  ADMIN
  REGULAR
}

model Picture {
  id          String   @id @default(uuid())
  filepath    String
  elo         Float
  numVotes    Int      @default(0)
  user        User     @relation(fields: [userId], references: [id], onDelete: Cascade)
  userId      String
  votes       Vote[]
  votesWinner Vote[]   @relation(name: "winnerPicture")
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
}

model Vote {
  id              String    @id @default(uuid())
  pictures        Picture[]
  winnerPicture   Picture   @relation(fields: [winnerPictureId], references: [id], name: "winnerPicture")
  winnerPictureId String
  voteTimestamp   DateTime?
  voter           User      @relation(fields: [voterId], references: [id])
  voterId         String
  activeUser      User?     @relation(name: "activeVote")
  createdAt       DateTime  @default(now())
  updatedAt       DateTime  @updatedAt
}
